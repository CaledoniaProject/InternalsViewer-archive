<div class="wikidoc"><h2>Allocation Map</h2>The Allocation Map shows a graphical representation of the layout of pages and extents in a database file or files.<br /><br /><b>Connecting to a server</b><br /><br />When the Allocation Map is opened the Connect to SQL Server dialog box is show.<br /><br />To connect the Allocation Map to a different SQL Server instance click the Connect to Server button:<br /><br /><img src="http://download-codeplex.sec.s-msft.com/Download?ProjectName=InternalsViewer&DownloadId=52541" alt="connect_to_server.png" title="connect_to_server.png" /><br /><br /><b>Databases</b><br /><br />The database displayed in the allocation map can be changed using the Database drop down list.<br /><br />[image:databases_dropdown.png]<br /> <br />When a database is first loaded Internals Viewer will scan through the object IAMs to build the allocation map. Progress can be seen on status bar in the bottom left.<br /> <br />Different objects are given different colours. <br /><br /><img src="http://download-codeplex.sec.s-msft.com/Download?ProjectName=InternalsViewer&DownloadId=52543" alt="allocation_map.png" title="allocation_map.png" /><br /><br /><b>Pages</b><br /><br />When the mouse is hovered over a page the status bar will display the page address and object that the page is allocated to in the bottom right hand corner.<br /><br /><img src="http://download-codeplex.sec.s-msft.com/Download?ProjectName=InternalsViewer&DownloadId=52547" alt="page_info.png" title="page_info.png" /><br /> <br />Clicking on a page in the Allocation Map will open it in the Page Viewer.<br /><br /><b>Page Address text box</b><br /><br />The page text box is in the top right hand corner of the Allocation Map window. Typing a page address in the format file id: page id and then pressing Enter will open the page in the Page Viewer.<br /><br /><img src="http://download-codeplex.sec.s-msft.com/Download?ProjectName=InternalsViewer&DownloadId=52553" alt="go_to_page.png" title="go_to_page.png" /><br /><br />Right clicking on a page address in the page text box will give several options:<br /><br /><img src="http://download-codeplex.sec.s-msft.com/Download?ProjectName=InternalsViewer&DownloadId=52555" alt="page_copy_options.png" title="page_copy_options.png" /><br />
<ul><li>Copy – this will copy the page address to the clipboard</li>
<li>Copy DDBC command to Clipboard – these options will script the necessary commands to view the page from a query window with DBCC PAGE</li></ul>
<br /><img src="http://download-codeplex.sec.s-msft.com/Download?ProjectName=InternalsViewer&DownloadId=52554" alt="dbcc_page.png" title="dbcc_page.png" /><br /><br /><b>Key</b><br /><br />A key is displayed at the bottom of the window including the index type, total pages used, and total pages allocated. It can be toggled on and off using the Key toolbar button:<br /> <br /><img src="http://download-codeplex.sec.s-msft.com/Download?ProjectName=InternalsViewer&DownloadId=52544" alt="key_button.png" title="key_button.png" /><br /><br />Clicking on an item in the key will highlight the object on the map and dim other objects. Clicking on the same object again will deselect it and show all object on the map.<br /><br /><b>File Details</b><br /><br />Toggling the File Details toolbar button will display the file details information at the bottom of the Allocation Map.<br /> <br /><img src="http://download-codeplex.sec.s-msft.com/Download?ProjectName=InternalsViewer&DownloadId=52546" alt="file_details.png" title="file_details.png" /><br /><br />File details are sourced from sys.database_files, sys.filegroups, and DBCC showfilestats.  Each file displayed in the Allocation Map will have its own File Details information bar.<br /><br /><b>Buffer Pool</b><br /><br />The buffer pool is SQL Server’s page memory cache. Pages can be dirty, which means they have been changed and not yet been written to disk.<br /><br />A graphical representation of the pages in the buffer pool can be displayed by toggling the Buffer Pool toolbar button.<br /><br />If a page is in the buffer pool it is darkened. If the page is dirty is has a red mark in the top left hand corner. <br /><br /><img src="http://download-codeplex.sec.s-msft.com/Download?ProjectName=InternalsViewer&DownloadId=52545" alt="buffer_pool.png" title="buffer_pool.png" /><br /><br />Not in buffer pool/in buffer pool/in buffer pool + dirty <br /><br />Buffer pool information is sourced from sys.dm<i>os</i>buffer_descriptors.<br /><br /><i>Note</i> The buffer pool is read from sys.dm<i>os</i>buffer_descriptors and mapped to the allocation map on an individual page basis. If a large number of pages are in the buffer pool Internals Viewer may become slow. <br /><br /><b>PFS</b><br /><br />The PFS (Page Free Space) is another allocation structure that stores the status of individual pages.<br /><br /><img src="http://download-codeplex.sec.s-msft.com/Download?ProjectName=InternalsViewer&DownloadId=52548" alt="pfs_key.png" title="pfs_key.png" /><br /><br />The PFS stores several pieces of information including how much space is free on the page, the allocation status (allocated/unallocated), if the page is an IAM, if the page is part of a mixed extent, and if the page contains Ghost Records.<br /><br />Clicking PFS on the toolbar will put the Allocation Map into PFS mode. <br /> <br />Hovering over a page will display a description of the PFS value for the page in the status bar in the bottom right hand corner of the application.<br /><br /><img src="http://download-codeplex.sec.s-msft.com/Download?ProjectName=InternalsViewer&DownloadId=52550" alt="pfs_info.png" title="pfs_info.png" /><br /><br /><b>Page Size</b><br /><br />The sizes of pages on the Allocation Map are determined by the Page Size drop down. <br /><br /><img src="http://download-codeplex.sec.s-msft.com/Download?ProjectName=InternalsViewer&DownloadId=52551" alt="page_size.png" title="page_size.png" /><br /><br />The dropdown has three options; Small, Medium, and Large. By default when the Allocation Map is in PFS mode the page size is set to Large.</div><div class="ClearBoth"></div>